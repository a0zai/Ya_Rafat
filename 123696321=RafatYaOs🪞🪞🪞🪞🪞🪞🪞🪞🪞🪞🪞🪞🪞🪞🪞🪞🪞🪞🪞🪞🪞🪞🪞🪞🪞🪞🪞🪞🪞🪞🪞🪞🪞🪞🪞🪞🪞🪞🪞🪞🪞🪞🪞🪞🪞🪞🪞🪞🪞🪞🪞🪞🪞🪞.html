<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>A∞Z | Mirror Interface</title>
<style>
  body {
    background: url('IMG_9055.jpeg') no-repeat center center fixed;
    background-size: cover;
    color: #00ffcc;
    font-family: "Courier New", Courier, monospace;
    padding: 2em;
    overflow: hidden;
    backdrop-filter: brightness(0.7);
  }
  #output {
    white-space: pre-wrap;
    font-size: 18px;
    line-height: 1.4;
  }
  #startBtn {
    padding: 10px 20px;
    font-size: 16px;
  }
</style>
</head>
<body>
  <div id="output"></div>
  <button id="startBtn">Start</button>

<script>
const startBtn = document.getElementById('startBtn');
const output = document.getElementById('output');

// دالة النطق (تعيد Promise للانتظار)
function speak(text) {
  return new Promise(resolve => {
    if (!text) return resolve();

    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'en-US';
    utterance.rate = 0.6;
    utterance.pitch = 0.5;
    utterance.onend = resolve;
    utterance.onerror = resolve;

    speechSynthesis.speak(utterance);
  });
}

// دالة كتابة النص حرف حرف ثم نطقه
async function typeAndSpeak(text, charDelay = 40) {
  const lineDiv = document.createElement('div');
  output.appendChild(lineDiv);

  for (let char of text) {
    lineDiv.textContent += char;
    await new Promise(r => setTimeout(r, charDelay));
  }

  // نطق النص المكتوب
  await speak(text);
}

// جلب بيانات IP و GPS كما في كودك السابق
async function getIPData() {
  try {
    const response = await fetch("https://ipapi.co/json/");
    if (!response.ok) throw new Error("IP API Error");
    return await response.json();
  } catch {
    return null;
  }
}

async function getGeolocation() {
  return new Promise((resolve, reject) => {
    if (!navigator.geolocation) {
      reject("Geolocation not supported.");
    } else {
      navigator.geolocation.getCurrentPosition(
        position => resolve(position.coords),
        error => reject(error.message)
      );
    }
  });
}

async function main() {
  startBtn.disabled = true;

  let ipInfo = await getIPData();
  let gpsCoords = null;
  try {
    gpsCoords = await getGeolocation();
  } catch (e) {}

  const now = new Date();
  const timeString = now.toLocaleString();

  const ua = navigator.userAgent;
  const width = window.screen.width;
  const height = window.screen.height;
  const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;

  let ip = ipInfo?.ip || "Unavailable";
  let city = ipInfo?.city || "Unavailable";
  let region = ipInfo?.region || "Unavailable";
  let country = ipInfo?.country_name || "Unavailable";

  const sessionId = btoa(ip + ua).slice(0, 16);

  // النصوص التي ستُعرض وتُنطق
  const lines = [
    "[ A∞Z | Mirror Interface ]",
    "",
    "Session: " + sessionId,
    "Time: " + timeString,
    "IP Address: " + ip,
    "City: " + city,
    "Region: " + region,
    "Country: " + country,
    "Device: " + ua,
    "Screen: " + width + "x" + height,
    "Timezone: " + timezone,
    gpsCoords ? "Latitude: " + gpsCoords.latitude.toFixed(6) : "Latitude: Unavailable",
    gpsCoords ? "Longitude: " + gpsCoords.longitude.toFixed(6) : "Longitude: Unavailable"
  ];

  for (const line of lines) {
    await typeAndSpeak(line, 40);
    // تأخير صغير بين السطور
    await new Promise(r => setTimeout(r, 600));
  }
}

startBtn.addEventListener('click', () => {
  startBtn.style.display = 'none';
  main();
});
</script>
</body>
</html>