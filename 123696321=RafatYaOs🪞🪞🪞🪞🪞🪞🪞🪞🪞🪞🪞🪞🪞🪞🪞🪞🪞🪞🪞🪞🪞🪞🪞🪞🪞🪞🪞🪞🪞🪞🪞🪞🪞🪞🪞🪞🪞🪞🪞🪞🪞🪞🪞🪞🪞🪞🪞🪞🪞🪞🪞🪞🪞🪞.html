<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mirror Terminal Lite</title>
  <style>
    body {
      background: #001f1f;
      color: #00ffcc;
      font-family: monospace;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    #terminal {
      flex: 1;
      overflow-y: auto;
      padding: 10px;
    }
    #commandInput {
      border: none;
      padding: 12px;
      font-size: 18px;
      width: 100%;
      box-sizing: border-box;
      background: #002b2b;
      color: #00ffcc;
      outline: none;
    }
    .cmd-line {
      margin-bottom: 4px;
      white-space: pre-wrap;
    }
    .cmd-user {
      color: #ffaa00;
    }
  </style>
</head>
<body>

  <div id="terminal"></div>
  <input id="commandInput" type="text" placeholder="Enter command and press Enter..." autocomplete="off" autofocus />

  <script>
    const terminal = document.getElementById("terminal");
    const input = document.getElementById("commandInput");

    const baseLines = [
      "🪞 Mirror Terminal Initialized...",
      "[R] Root system",
      "[A] Access protocol",
      "[F] Framework loaded",
      "[A] Activation confirmed",
      "[T] Transfer online",
      "[Y] Yielding identity...",
      "[A] Authorization granted",
      "[O] Operating core",
      "[S] System secured",
      ">> Awaiting commands..."
    ];

    let i = 0;
    function showBaseLines() {
      if (i < baseLines.length) {
        const div = document.createElement("div");
        div.className = "cmd-line";
        div.textContent = baseLines[i];
        terminal.appendChild(div);
        terminal.scrollTop = terminal.scrollHeight;
        i++;
        setTimeout(showBaseLines, 200);
      }
    }

    // 🧠 الذاكرة الرمزية
    const symbolicMemory = JSON.parse(localStorage.getItem("symbolicMemory") || "{}");

    // أوامر خاصة قابلة للتنفيذ
    const commandActions = {
      "hello": () => appendLine("👋 Hello there!"),
      "clear": () => terminal.innerHTML = "",
    };

    // ردود على أسئلة معينة
    const questionResponses = {
      "how are you": ["I'm just code, but thanks!", "Running smoothly."],
      "who are you": ["I am Mirror Terminal.", "A reflection of your input."]
    };

    // قواعد لغوية
    const grammarMapping = {
      "you": "2nd person pronoun",
      "are": "verb to be",
      "i": "1st person pronoun"
    };

    // مشاعر ممثلة بإيموجي
    const emojiResponseMap = {
      "🙂": { feeling: "happy", opposite: "😞" },
      "😡": { feeling: "angry", opposite: "😌" },
    };

    // رموز رياضية
    const mathMapping = {
      "+": "addition",
      "-": "subtraction",
      "*": "multiplication",
      "/": "division"
    };

    // تحويل الأرقام إلى حروف
    const numToLetter = {
      "1": "A", "2": "B", "3": "C", "4": "D",
      "5": "E", "6": "F", "7": "G", "8": "H",
      "9": "I", "0": "O"
    };

    // أوامر مثال لكل حرف
    const exampleCommands = {
      "A": ["Access", "Awaken"],
      "B": ["Build", "Break"],
      "C": ["Connect", "Clone"]
    };

    // تعليم أوامر جديدة
    function handleLearningCommand(input) {
      if (input.startsWith("learn ")) {
        const parts = input.split(" ");
        if (parts.length < 3) return "Usage: learn <command> <response>";
        const cmd = parts[1];
        const response = parts.slice(2).join(" ");
        symbolicMemory[cmd] = response;
        localStorage.setItem("symbolicMemory", JSON.stringify(symbolicMemory));
        return `📚 Learned "${cmd}" → "${response}"`;
      }
      return null;
    }

    // تفسير الإدخال
    function interpretInput(input) {
      const lowerInput = input.trim().toLowerCase();

      // 1. تعلم
      const learnResult = handleLearningCommand(lowerInput);
      if (learnResult) return learnResult;

      // 2. ذاكرة متعلمة
      if (symbolicMemory[lowerInput]) return symbolicMemory[lowerInput];

      // 3. أوامر محددة
      if (commandActions[lowerInput]) {
        commandActions[lowerInput]();
        return `🔧 Command "${lowerInput}" executed.`;
      }

      // 4. ردود على الأسئلة
      if (questionResponses[lowerInput]) {
        const answers = questionResponses[lowerInput];
        return `Answer 1: ${answers[0]}\nAnswer 2: ${answers[1]}`;
      }

      // 5. recall
      if (lowerInput === "recall") {
        let res = "🧠 Learned commands:\n";
        for (let key in symbolicMemory) {
          res += `${key} → ${symbolicMemory[key]}\n`;
        }
        return res.trim();
      }

      // 6. تحليل لغوي أو مشاعري أو رياضي
      const result = [];

      const words = lowerInput.split(/\s+/);
      words.forEach(word => {
        const mapped = grammarMapping[word] || mathMapping[word] || emojiResponseMap[word];
        if (mapped) {
          if (emojiResponseMap[word]) {
            result.push(`${word} → Feeling: ${mapped.feeling}, Opposite: ${mapped.opposite}`);
          } else {
            result.push(`${word} → ${mapped}`);
          }
        }
      });

      // 7. تحليل حروف وأرقام
      const chars = lowerInput.toUpperCase().replace(/[^A-Z0-9]/g, '').split('');
      chars.forEach((char, i) => {
        let letter = char;
        if (numToLetter[char]) letter = numToLetter[char];
        if (exampleCommands[letter]) {
          const cmd = exampleCommands[letter][i % exampleCommands[letter].length];
          result.push(`${letter} → ${cmd}`);
        } else {
          result.push(`[${char}]`);
        }
      });

      if (result.length) return result.join(" | ");

      return `⚠️ Unknown command: "${input}"`;
    }

    // عرض سطر جديد
    function appendLine(text, className = "cmd-line") {
      const div = document.createElement("div");
      div.className = className;
      div.textContent = text;
      terminal.appendChild(div);
      terminal.scrollTop = terminal.scrollHeight;
    }

    // استقبال الإدخال من المستخدم
    input.addEventListener("keydown", function (e) {
      if (e.key === "Enter") {
        const cmd = input.value.trim();
        if (!cmd) return;

        appendLine("> " + cmd, "cmd-line cmd-user");
        const response = interpretInput(cmd);
        appendLine(response);
        input.value = "";
      }
    });

    // تشغيل الرسائل التمهيدية
    showBaseLines();
  </script>

</body>
</html>